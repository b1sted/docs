---
title: "Лекция 6: Организация ввода-вывода в Си"
---

> "_Кто рано встает — тому весь день спать хочется." <br/> 
> &mdash; Джейсон Стейтем_

***

## Введение в ввод-вывод (ВВ) в C

**Ввод-вывод** – это взаимодействие между системой обработки информации и внешним миром (пользователем или другим устройством). В языке Си ВВ реализован через потоки – абстракцию, представляющую последовательность байтов.

```c
#include <stdio.h>  // Подключаем библиотеку для ввода-вывода

int main() {
    int c;  // Переменная для хранения введенного символа

    // Запрашиваем у пользователя ввод символа
    printf("Введите символ: ");
    c = getchar(); // Читаем символ с клавиатуры

    // Выводим сообщение о введенном символе
    printf("Вы ввели: ");
    putchar(c); // Выводим сам символ на экран

    return 0; // Завершаем программу успешно
}
```

***

## Стандартные потоки в C

При запуске программы в C создаются три стандартных потока:

* `stdin` – для ввода данных с клавиатуры.
* `stdout` – для вывода данных на экран.
* `stderr` – для вывода сообщений об ошибках.

```c
#include <stdio.h>  // Подключаем библиотеку для ввода-вывода

int main() {
    // Выводим сообщение в стандартный поток (stdout)
    fprintf(stdout, "Это вывод в стандартный поток.\n"); 

    // Выводим сообщение в стандартный поток ошибок (stderr)
    fprintf(stderr, "Это вывод ошибки в стандартный поток ошибок.\n"); 
    
    return 0;  // Завершаем программу успешно
}
```

***

## Форматированный ввод и вывод

**Форматированный ввод** выполняется функцией `scanf`, а **форматированный вывод** – функцией `printf`.

```c
#include <stdio.h>  // Подключаем библиотеку для ввода-вывода

int main() {
    int a;        // Переменная для хранения целого числа
    float b;     // Переменная для хранения числа с плавающей точкой

    // Запрашиваем ввод целого числа и числа с плавающей точкой у пользователя
    printf("Введите целое число и число с плавающей точкой: ");
    
    // Считываем данные с форматированием
    scanf("%d %f", &a, &b); 
    
    // Выводим введенные значения с форматированием
    printf("Целое число: %d, число с плавающей точкой: %.2f\n", a, b); 

    return 0;  // Завершаем программу успешно
}
```

***

## Работа с файлами

Файлы в C обрабатываются через указатели типа `FILE*`, и основные функции работы с файлами включают `fopen`, `fclose`, `fread`, `fwrite`, `fprintf`, `fscanf`.

Открытие и закрытие файла:

```c
#include <stdio.h>  // Подключаем библиотеку для ввода-вывода

int main() {
    FILE *fp;  // Указатель на файл

    // Открываем файл example.txt для записи
    fp = fopen("example.txt", "w"); 
    if (fp == NULL) {  // Проверяем, удалось ли открыть файл
        perror("Ошибка открытия файла");  // Выводим сообщение об ошибке
        return -1;  // Завершаем программу с кодом ошибки
    }

    // Записываем строку в файл 
    fprintf(fp, "Запись в файл example.txt\n"); 

    // Закрываем файл после завершения работы
    fclose(fp); 
    
    return 0;  // Завершаем программу успешно
}
```

Чтение из файла:

```c
#include <stdio.h>  // Подключаем библиотеку для ввода-вывода

int main() {
    FILE *fp;               // Указатель на файл
    char buffer[100];      // Буфер для хранения строки, считанной из файла

    // Открываем файл example.txt для чтения
    fp = fopen("example.txt", "r"); 
    if (fp == NULL) {  // Проверяем, удалось ли открыть файл
        perror("Ошибка открытия файла");  // Выводим сообщение об ошибке
        return -1;  // Завершаем программу с кодом ошибки
    }

    // Читаем строки из файла и выводим их на экран
    while (fgets(buffer, sizeof(buffer), fp) != NULL) { 
        printf("%s", buffer);  // Выводим считанную строку
    }

    fclose(fp); // Закрываем файл после завершения работы

    return 0;  // Завершаем программу успешно
}
```

***

## Низкоуровневый ввод-вывод

На низком уровне функции ВВ, такие как `open`, `close`, `read`, и `write`, взаимодействуют напрямую с операционной системой.

```c
#include <fcntl.h>   // Для работы с файловыми дескрипторами
#include <unistd.h>  // Для работы с системными вызовами (например, read, close)
#include <stdio.h>   // Для стандартного ввода-вывода

int main() {
    // Открываем файл example.txt для чтения
    int fd = open("example.txt", O_RDONLY); 
    if (fd == -1) {  // Проверяем, удалось ли открыть файл
        perror("Ошибка открытия файла");  // Выводим сообщение об ошибке
        return -1;  // Завершаем программу с кодом ошибки
    }

    char buffer[100];  // Буфер для хранения прочитанных данных

    // Читаем данные из файла 
    int bytesRead = read(fd, buffer, sizeof(buffer) - 1); 
    if (bytesRead > 0) {  // Проверяем, были ли прочитаны данные
        buffer[bytesRead] = '\0';  // Завершаем строку нулевым символом
        printf("Содержимое файла: %s\n", buffer);  // Выводим содержимое файла
    }

    close(fd); // Закрываем файл после завершения работы

    return 0;  // Завершаем программу успешно
}
```

***

## Буферизация и обработка ошибок

Буферизация позволяет ускорить ВВ, а ошибки ВВ проверяются через функции, такие как `ferror` и `clearerr`.

```c
#include <stdio.h>  // Подключаем библиотеку для ввода-вывода

int main() {
    FILE *fp;  // Указатель на файл

    // Открываем файл example.txt для чтения
    fp = fopen("example.txt", "r");
    if (fp == NULL) {  // Проверяем, удалось ли открыть файл
        perror("Ошибка открытия файла");  // Выводим сообщение об ошибке
        return -1;  // Завершаем программу с кодом ошибки
    }

    // Считываем один символ из файла
    int ch = fgetc(fp); 
    if (ch == EOF) {  // Проверяем, достигнут ли конец файла
        if (ferror(fp)) {  // Проверяем, была ли ошибка чтения
            perror("Ошибка чтения файла");  // Выводим сообщение об ошибке
            clearerr(fp);  // Очищаем статус ошибки для файла
        } else {
            printf("Достигнут конец файла.\n");  // Сообщаем о достижении конца файла
        }
    } else {
        printf("Считанный символ: %c\n", ch); // Если успешно считан символ, выводим его на экран
    }

    // Закрываем файл после завершения работы
    fclose(fp); 

    return 0;  // Завершаем программу успешно
}
```

***

> [_Seen all good things and bad_](https://www.youtube.com/watch?v=IOax8WSeEGM\&pp=ygUTaG93IGNhbiB5b3UgYmUgc3VyZQ%3D%3D)
